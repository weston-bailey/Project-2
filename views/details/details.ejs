
<!-- the map -->
<div class="containter" class="position-static">
  <div id="map">
  </div>
</div>
<!-- all content under the map -->
<div class="under-map">
  <!-- details for earthquake -->
  <%= //earthquake. %> 
  <div class="d-flex flex-column">
    <div class="d-flex w-100 justify-content-between">
      <div class="containter">
        <h4> <%= earthquake.place %> </h4>
      </div>
    </div>
      <div class="d-flex w-100 justify-content-between">
      <div class="containter">
        <small class="text-muted"> <%= earthquake.localTime %> </small>
      </div>
    </div>
    <div class="d-flex w-100 justify-content-between">
      <div class="containter">
        <h5>Mag:</h5>
        <h6><%= earthquake.mag %></h6>
      </div>
      <div class="containter">
        <h5>Depth:</h5>
        <h6><%= earthquake.depth %>km</h6>
      </div>
      <div class="containter">
        <h5>Latitude:</h6>
        <h6><%= earthquake.latitude %></h6>
      </div>
      <div class="containter">
        <h5>Longitude:</h5>
        <h6><%= earthquake.longitude %></h6>
      </div>
    </div>
    <% if(earthquake.alert === null) { %>
      <div class="d-flex w-100 justify-content-between">
        <h6>No alerts issued for this earthquake</h6>
      </div>
  <% } else if (earthquake.alert === "green") { %>
    <div class="d-flex w-100 justify-content-between">
      <h5><i class="fa fa-warning"></i>This earthquake was issued an alert level of green </h5>
    </div>
  <% } else if (earthquake.alert === "yellow") { %>
    <div class="d-flex w-100 justify-content-between">
      <h5><i class="fa fa-warning"></i>This earthquake was issued an alert level of yellow </h5>
    </div>
  <% } else if (earthquake.alert === "orange") { %>
    <div class="d-flex w-100 justify-content-between">
      <h5><i class="fa fa-warning"></i>This earthquake was issued an alert level of orange </h5>
    </div>
  <% } else if (earthquake.alert === "red") { %>
    <div class="d-flex w-100 justify-content-between">
      <h5><i class="fa fa-warning"></i>This earthquake was issued an alert level of red </h5>
    </div>
  <% } %>
  </div>
  <!-- comments if user is logged out -->
  <% if(!currentUser) { %>
    <div class="d-flex w-100">
      <p><a href="/auth/register">Register</a> or <a href="/auth/login">Login</a> to join in with the Quakebook community and comment on this earthquake!</p>
    </div>
  <!-- comments if user is logged in -->
  <% } else { %>
    <!-- comment form -->
    <form action="/details/<%= earthquake.id %>/comment " method="POST">
      <div class="form-group">
        <label for="text">Hi <%= userData.firstName %>, type your comment below:</label>
        <textarea type="text" class="form-control" id="text" name="text" required></textarea>
        <input class="btn btn-dark" type="submit">
      </form>
    <!-- comment list -->
    <div class="list-group">
      <% comments.forEach(comment => { %>
        <!-- begin testing... -->
        <% if(currentUser.id === comment.userId) { %>
          <!-- comment show tab -->
          <div class="list-group-item">
            <div class="d-flex w-100 justify-content-between">
                <h6> <a href="/users/<%= comment.userId %>"> You </a> said:</h6>
                <small class="text-muted"><%= comment.localTime %></small>
            </div>        
          <div class="tab-content">
            <div class="tab-pane fade show active" id="comment-show-<%= comment.id %>">
              <div class="container">
                <p><%= comment.text %></p>
              </div>
              <!-- nested tab controls -->
              <div class="d-flex w-100 flex-row-reverse">
                <ul class="list-inline">
                  <li class="list-inline-item"> 
                    <button type="button" class="btn btn-warning" href="#comment-edit-<%= comment.id %>" class="" data-toggle="tab">Edit</button>
                  </li>
                  <li class="list-inline-item"> 
                    <form id="delete-form-<%= comment.id %>" method="POST" action="/details/<%= earthquake.id %>/comment/<%= comment.id %>/delete/?_method=DELETE"></form>
                    <button type="button" class="btn btn-danger" onclick="document.getElementById('delete-form-<%= comment.id %>').submit();" >Delete</button>
                  </li>
                  <li class="list-inline-item">
                    <!-- TODO make accordian for reply -->
                    <form id="reply-form-<%= comment.id %>" method="POST" action="/details/<%= earthquake.id %>/comment/<%= comment.id %>/reply"></form>
                    <button type="button" class="btn btn-dark" onclick="document.getElementById('reply-form-<%= comment.id %>').submit();" >Reply</button>
                  </li>
                </ul>
              </div>
            </div>
            <!-- comment edit tab -->
            <div class="tab-pane fade" id="comment-edit-<%= comment.id %>">
              <form method="POST" action="/details/<%= earthquake.id %>/comment/<%= comment.id %>/edit/?_method=PUT">
                <input id="edit" type="text" rows="3" class="form-control" id="text" name="text" value="<%= comment.text %>">
                <div class="d-flex w-100 justify-content-between">
                  <input class="btn btn-dark" type="submit">
                  <button type="button" class="btn btn-dark" href="#comment-show-<%= comment.id %>" class="" data-toggle="tab">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <!-- comment from a different user-->
        <% } else { %>
        <div class="list-group-item">
          <div class="d-flex w-100 justify-content-between">
              <h6> <a href="/users/<%= comment.userId %>"> <%= comment.userName %> </a> said:</h6>
              <small class="text-muted"><%= comment.localTime %></small>
          </div>      
          <div class="container">  
            <p><%= comment.text %></p>
          </div>
          <div class="d-flex w-100 flex-row-reverse">
            <ul class="list-inline">
              <li class="list-inline-item">
                <!-- TODO make accordian for reply -->
                <form id="reply-form-<%= comment.id %>" method="POST" action="/details/<%= earthquake.id %>/comment/<%= comment.id %>/reply"></form>
                <button type="button" class="btn btn-dark" onclick="document.getElementById('reply-form-<%= comment.id %>').submit();" >Reply</button>
              </li>
            </ul>
          </div>
        </div>
        <% }  %>
      <!--  end testing... -->
    </div>
      <% }) %>
    <% } %>
</div>


<!-- data for local js -->

<% let latitude = earthquake.latitude; %>
<%  let longitude = earthquake.longitude; %>
<% let mapkey = mapKey; %>

<div id="dataDiv" 
data-mapkey=<%= mapKey %>
data-id=<%= earthquake.id %>
data-latitude=<%= latitude %>
data-longitude=<%= longitude  %>>
</div>

<!-- mapbox js -->
<script src="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script>
<!-- axios client js -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<!-- local map js -->
<script src="/js/map-details.js"></script>